{
    "name": "Centurion (External PV)",
    "category": "TH-E Box",
    "group": "Inverter",
    "description": "EnergyDepot GmbH Centurion inverter with external PV",
    
    "devices": [
        {
            "name": "Centurion",
            "driver": "edcom",
            "settings": "user:ISC Konstanz"
        },
        {
            "name": "Inverter",
            "driver": "virtual"
        }
    ],
    
    "options": [
        {
            "id": "ip",
            "name": "IP address",
            "description": "The IP address of the EnergyDepot GmbH product, a connection should be established to.",
            "type": "text",
            "mandatory": true,
            "syntax": "deviceAddress"
        }
    ],
    
    "items": [
        {
            "id": "external",
            "type": "Switch",
            "label": "External PV",
            "default": true,
            "mapping": {
                "ON": { "channel": "inv_external_enable", "value": true },
                "OFF": { "channel": "inv_external_enable", "value": false }
            },
            "input": "inv_external_enable"
        },
        {
            "id": "objective",
            "type": "Slider",
            "label": "Import/Export",
            "format": "%.1f kW",
            "max": 10000,
            "min": -10000,
            "step": 500,
            "scale": -0.001,
            "mapping": {
                "SET": { "channel": "inv_objective", "write": false }
            },
            "input": "inv_objective"
        },
        {
            "id": "soc",
            "type": "Text",
            "label": "State of Charge",
            "format": "%i %",
            "max": 100,
            "min": 0,
            "input": "inv_bat_soc"
        }
    ],
    
    "channels": [
        {
            "name": "inv_objective",
            "description": "inv_objective",
            "node": "Virtual",
            "device": "Inverter",
            "logging": {"loggingInterval": 5000, "loggingMaxInterval": 60000},
            "configs": {"valueType":"DOUBLE"}
        },
        {
            "name": "inv_objective_local",
            "description": "inv_objective_local",
            "device": "Centurion",
            "address": "inv_objective_local",
            "logging": {"loggingInterval": 5000, "loggingMaxInterval": 60000},
            "configs": {"samplingInterval": 5000, "valueType":"DOUBLE"}
        },
        {
            "name": "inv_bat_soc",
            "description": "storage_el_soc",
            "device": "Centurion",
            "address": "BAT_SOC",
            "logging": {"loggingInterval": 5000, "loggingMaxInterval": 60000, "loggingTolerance": 0.1},
            "configs": {"samplingInterval": 5000, "valueType":"DOUBLE"},
            "processList": [
                {
                    "process": "log_to_feed",
                    "arguments": {"type": "ProcessArg::FEEDID", "value": "storage_el_soc"}
                }
            ]
        },
        {
            "name": "inv_bat_power",
            "description": "storage_el_power",
            "device": "Centurion",
            "address": "BAT_POWER",
            "logging": {"loggingInterval": 5000, "loggingMaxInterval": 60000, "loggingTolerance": 10, "average": true},
            "configs": {"samplingInterval": 5000, "valueType":"DOUBLE"},
            "processList": [
                {
                    "process": "log_to_feed",
                    "arguments": {"type": "ProcessArg::FEEDID", "value": "storage_el_power"}
                },
                {
                    "process": "allowpositive",
                    "arguments": {"type": "ProcessArg::NONE"}
                },
                {
                    "process": "log_to_feed",
                    "arguments": {"type": "ProcessArg::FEEDID", "value": "storage_el_charge"}
                },
                {
                    "process": "reset2original",
                    "arguments": {"type": "ProcessArg::NONE"}
                },
                {
                    "process": "allownegative",
                    "arguments": {"type": "ProcessArg::NONE"}
                },
                {
                    "process": "scale",
                    "arguments": {"type": "ProcessArg::VALUE", "value": "-1"}
                },
                {
                    "process": "log_to_feed",
                    "arguments": {"type": "ProcessArg::FEEDID", "value": "storage_el_discharge"}
                }
            ]
        },
        {
            "name": "inv_bat_voltage",
            "description": "storage_el_voltage",
            "device": "Centurion",
            "address": "BAT_VOLTAGE",
            "logging": {"loggingInterval": 5000, "loggingMaxInterval": 60000, "loggingTolerance": 0.01, "average": true},
            "configs": {"samplingInterval": 5000, "valueType":"DOUBLE"},
            "processList": [
                {
                    "process": "log_to_feed",
                    "arguments": {"type": "ProcessArg::FEEDID", "value": "storage_el_voltage"}
                }
            ]
        },
        {
            "name": "inv_dc_power",
            "description": "inv_dc_power",
            "device": "Centurion",
            "address": "DC_POWER",
            "logging": {"loggingInterval": 5000, "loggingMaxInterval": 60000, "loggingTolerance": 10, "average": true},
            "configs": {"samplingInterval": 5000, "valueType":"DOUBLE"},
            "processList": [
                {
                    "process": "log_to_feed",
                    "arguments": {"type": "ProcessArg::FEEDID", "value": "inv_dc_power"}
                },
                {
                    "process": "power_to_kwh",
                    "arguments": {"type": "ProcessArg::FEEDID", "value": "inv_dc_energy"}
                }
            ]
        },
        {
            "name": "inv_dc1_voltage",
            "description": "inv_dc1_voltage",
            "device": "Centurion",
            "address": "DC_1_VOLTAGE",
            "logging": {"loggingInterval": 5000, "loggingMaxInterval": 60000, "loggingTolerance": 0.01, "average": true},
            "configs": {"samplingInterval": 5000, "valueType":"DOUBLE"},
            "processList": [
                {
                    "process": "log_to_feed",
                    "arguments": {"type": "ProcessArg::FEEDID", "value": "inv_dc1_voltage"}
                }
            ]
        },
        {
            "name": "inv_dc2_voltage",
            "description": "inv_dc2_voltage",
            "device": "Centurion",
            "address": "DC_2_VOLTAGE",
            "logging": {"loggingInterval": 5000, "loggingMaxInterval": 60000, "loggingTolerance": 0.01, "average": true},
            "configs": {"samplingInterval": 5000, "valueType":"DOUBLE"},
            "processList": [
                {
                    "process": "log_to_feed",
                    "arguments": {"type": "ProcessArg::FEEDID", "value": "inv_dc2_voltage"}
                }
            ]
        },
        {
            "name": "inv_ac_active_power",
            "description": "grid_active_power",
            "device": "Centurion",
            "address": "GRID_ACTIVE_POWER",
            "logging": {"loggingInterval": 5000, "loggingMaxInterval": 60000, "loggingTolerance": 10, "average": true},
            "configs": {"samplingInterval": 5000, "valueType":"DOUBLE"}
        },
        {
            "name": "inv_ac_reactive_power",
            "description": "grid_reactive_power",
            "device": "Centurion",
            "address": "GRID_REACTIVE_POWER",
            "logging": {"loggingInterval": 5000, "loggingMaxInterval": 60000, "loggingTolerance": 10, "average": true},
            "configs": {"samplingInterval": 5000, "valueType":"DOUBLE"},
            "processList": [
                {
                    "process": "log_to_feed",
                    "arguments": {"type": "ProcessArg::FEEDID", "value": "grid_reactive_power"}
                }
            ]
        },
        {
            "name": "inv_ac_voltage",
            "description": "grid_voltage",
            "device": "Centurion",
            "address": "GRID_VOLTAGE",
            "logging": {"loggingInterval": 5000, "loggingMaxInterval": 60000, "loggingTolerance": 0.01, "average": true},
            "configs": {"samplingInterval": 5000, "valueType":"DOUBLE"},
            "processList": [
                {
                    "process": "log_to_feed",
                    "arguments": {"type": "ProcessArg::FEEDID", "value": "grid_voltage"}
                }
            ]
        },
        {
            "name": "inv_ac_frequency",
            "description": "grid_frequency",
            "device": "Centurion",
            "address": "GRID_FREQUENCY",
            "logging": {"loggingInterval": 5000, "loggingMaxInterval": 60000, "loggingTolerance": 0.01, "average": true},
            "configs": {"samplingInterval": 5000, "valueType":"DOUBLE"},
            "processList": [
                {
                    "process": "log_to_feed",
                    "arguments": {"type": "ProcessArg::FEEDID", "value": "grid_frequency"}
                }
            ]
        },
        {
            "name": "inv_cons_power",
            "description": "consumption_power",
            "node": "Virtual",
            "device": "Inverter",
            "logging": {"loggingInterval": 5000, "loggingMaxInterval": 60000, "loggingTolerance": 10, "average": true},
            "configs": {"valueType":"DOUBLE"},
            "processList": [
                {
                    "process": "log_to_feed",
                    "arguments": {"type": "ProcessArg::FEEDID", "value": "consumption_power"}
                },
                {
                    "process": "power_to_kwh",
                    "arguments": {"type": "ProcessArg::FEEDID", "value": "consumption_energy"}
                }
            ]
        },
        {
            "name": "inv_external_enable",
            "description": "inv_external_enable",
            "node": "Virtual",
            "device": "Inverter",
            "logging": {"loggingInterval": 5000, "loggingMaxInterval": 60000},
            "configs": {"valueType":"BOOLEAN"}
        },
        {
            "name": "inv_ac_virtual_power",
            "description": "grid_active_power",
            "node": "Virtual",
            "device": "Inverter",
            "logging": {"loggingInterval": 5000, "loggingMaxInterval": 60000, "loggingTolerance": 10, "average": true},
            "configs": {"valueType":"DOUBLE"},
            "processList": [
                {
                    "process": "log_to_feed",
                    "arguments": {"type": "ProcessArg::FEEDID", "value": "grid_active_power"}
                },
                {
                    "process": "allowpositive",
                    "arguments": {"type": "ProcessArg::NONE"}
                },
                {
                    "process": "log_to_feed",
                    "arguments": {"type": "ProcessArg::FEEDID", "value": "grid_import_power"}
                },
                {
                    "process": "power_to_kwh",
                    "arguments": {"type": "ProcessArg::FEEDID", "value": "grid_import_energy"}
                },
                {
                    "process": "reset2original",
                    "arguments": {"type": "ProcessArg::NONE"}
                },
                {
                    "process": "allownegative",
                    "arguments": {"type": "ProcessArg::NONE"}
                },
                {
                    "process": "scale",
                    "arguments": {"type": "ProcessArg::VALUE", "value": "-1"}
                },
                {
                    "process": "log_to_feed",
                    "arguments": {"type": "ProcessArg::FEEDID", "value": "grid_export_power"}
                },
                {
                    "process": "power_to_kwh",
                    "arguments": {"type": "ProcessArg::FEEDID", "value": "grid_export_energy"}
                }
            ]
        }
    ],

    "feeds": [
        {
            "name": "storage_el_soc",
            "tag": "State",
            "type": "DataType::REALTIME",
            "engine": "Engine::PHPTIMESERIES"
        },
        {
            "name": "storage_el_power",
            "tag": "Power",
            "type": "DataType::REALTIME",
            "engine": "Engine::PHPTIMESERIES"
        },
        {
            "name": "storage_el_charge",
            "tag": "Power",
            "type": "DataType::REALTIME",
            "engine": "Engine::PHPTIMESERIES"
        },
        {
            "name": "storage_el_discharge",
            "tag": "Power",
            "type": "DataType::REALTIME",
            "engine": "Engine::PHPTIMESERIES"
        },
        {
            "name": "storage_el_voltage",
            "tag": "Voltage",
            "type": "DataType::REALTIME",
            "engine": "Engine::PHPTIMESERIES"
        },
        {
            "name": "inv_dc_power",
            "tag": "Power",
            "type": "DataType::REALTIME",
            "engine": "Engine::PHPTIMESERIES"
        },
        {
            "name": "inv_dc_energy",
            "tag": "Energy",
            "type": "DataType::REALTIME",
            "engine": "Engine::PHPTIMESERIES"
        },
        {
            "name": "inv_dc1_voltage",
            "tag": "Voltage",
            "type": "DataType::REALTIME",
            "engine": "Engine::PHPTIMESERIES"
        },
        {
            "name": "inv_dc2_voltage",
            "tag": "Voltage",
            "type": "DataType::REALTIME",
            "engine": "Engine::PHPTIMESERIES"
        },
        {
            "name": "grid_active_power",
            "tag": "Power",
            "type": "DataType::REALTIME",
            "engine": "Engine::PHPTIMESERIES"
        },
        {
            "name": "grid_reactive_power",
            "tag": "Power",
            "type": "DataType::REALTIME",
            "engine": "Engine::PHPTIMESERIES"
        },
        {
            "name": "grid_import_power",
            "tag": "Power",
            "type": "DataType::REALTIME",
            "engine": "Engine::PHPTIMESERIES"
        },
        {
            "name": "grid_import_energy",
            "tag": "Energy",
            "type": "DataType::REALTIME",
            "engine": "Engine::PHPTIMESERIES"
        },
        {
            "name": "grid_export_power",
            "tag": "Power",
            "type": "DataType::REALTIME",
            "engine": "Engine::PHPTIMESERIES"
        },
        {
            "name": "grid_export_energy",
            "tag": "Energy",
            "type": "DataType::REALTIME",
            "engine": "Engine::PHPTIMESERIES"
        },
        {
            "name": "grid_voltage",
            "tag": "Voltage",
            "type": "DataType::REALTIME",
            "engine": "Engine::PHPTIMESERIES"
        },
        {
            "name": "grid_frequency",
            "tag": "Frequency",
            "type": "DataType::REALTIME",
            "engine": "Engine::PHPTIMESERIES"
        },
        {
            "name": "consumption_power",
            "tag": "Power",
            "type": "DataType::REALTIME",
            "engine": "Engine::PHPTIMESERIES"
        },
        {
            "name": "consumption_energy",
            "tag": "Energy",
            "type": "DataType::REALTIME",
            "engine": "Engine::PHPTIMESERIES"
        }
    ],
    
    "syntax": {
        "deviceAddress": {
            "keyValue": true
        }
    }
}
